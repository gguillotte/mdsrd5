<html>

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

    <title>The Markdown SRD5 - Spell Filter</title>

    <!--[if lt IE 9]>
      <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
    <![endif]-->

    <script src="jquery.min.js" type="text/javascript"></script>
    <script src="jquery.dynatable.js" type="text/javascript"></script>
    <script src="mdsrd5_spells.js" type="text/javascript"></script>

    <!-- Remote and external CSS -->
    <link href="https://fonts.googleapis.com/css?family=Alegreya:400,400italic,700,700italic" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Alegreya Sans:400,400italic,700,700italic" rel="stylesheet" type="text/css">
    <!-- /Remote and external CSS -->
    
    <link rel="stylesheet" href="../../normalize.css">
    <link rel="stylesheet" href="../../multipage.css">
    <link rel="stylesheet" href="jquery.dynatable.css">

    <script type="text/javascript">
      var spells = magic.spells;
      
      function spellAttributeWriter(record) {
        // `this` is the column object in settings.columns
        // TODO: automatically convert common types, such as arrays and objects, to string
        var this_record = record[this.id];
        var object_output = "";
        var this_record_type = $.type(this_record);
        if ( this_record_type === 'array' ) {
          return this_record.join(', ');
        } else if ( this_record === false ) {
          return '--';
        } else if ( this_record === true ) {
          return '(ritual)';
        } else if ( this_record_type === 'object' ) {
          $.each(this_record, function(key, value) {
            if ( ( value !== null ) && ( value !== false ) ) {
              if ( $.type(value) === 'array' ) {
                object_output += value.join(', ') + ' ';
              } else if ( key === 'materials' ) {
                object_output += '(' + value + ')';
              } else if ( ( key == 'concentration' ) && ( value == true ) ) {
                object_output = 'Concentration, up to ' + object_output + ' ';
              } else {
                object_output += value + ' ';
              }
            }
          });
          return object_output;
        } else if ( this.label === 'Name' ) {
          return '<a href="' + record.url + '">' + record.name + '</a>';
        } else {
          return this_record;
        }
      };

      $( document ).ready(function() {
        $('#results_table')
          .bind('dynatable:init', function(e, dynatable) {
            dynatable.queries.functions['query_classes'] = function(spell, queryValue) {
              var is_class = spell.classes.filter(function(classes) { return classes.includes(queryValue); });
              return is_class == queryValue;
            };
            dynatable.queries.functions['query_castingTime'] = function(spell, queryValue) {
              var casting_time_unit = spell.castingTime.unit;
              return casting_time_unit.includes(queryValue);
            };
            dynatable.queries.functions['query_duration'] = function(spell, queryValue) {
              var duration_unit = spell.duration.unit;
              return duration_unit.includes(queryValue);
            };
            dynatable.queries.functions['query_components'] = function(spell, queryValue) {
              var components = spell.components.types.join();
              return components.includes(queryValue);
            };
            dynatable.queries.functions['query_concentration'] = function(spell, queryValue) {
              var requires_concentration = spell.duration.concentration;
              return requires_concentration == queryValue;
            };
          })
          .dynatable({
            dataset: {
              records: spells
            },
            writers: {
              _attributeWriter: spellAttributeWriter
            },
            inputs: {
              queryEvent: 'blur change keyup',
              queries: $('.updates_table')
            }
          });
      });
    </script>
    
  </head>

  <body>

    <header>
      <h1>The Markdown SRD5</h1>
      <h2>Spell Filter</h2>
    </header>

    <section id="query_selectors">
      <div class="query_selector" id="query_selectors_classes">
        <label>Classes: </label>
        <select id="query_classes" class="updates_table" name="query_classes">
          <option></option>
          <option>Bard</option>
          <option>Cleric</option>
          <option>Druid</option>
          <option>Paladin</option>
          <option>Ranger</option>
          <option>Sorcerer</option>
          <option>Warlock</option>
          <option>Wizard</option>
        </select>
      </div>

      <div class="query_selector" id="query_selectors_level">
        <label>Level: </label>
        <select id="level" class="updates_table" name="level">
          <option></option>
          <option value="0">Cantrip</option>
          <option>1</option>
          <option>2</option>
          <option>3</option>
          <option>4</option>
          <option>5</option>
          <option>6</option>
          <option>7</option>
          <option>8</option>
          <option>9</option>
        </select>
      </div>

      <div class="query_selector" id="query_selectors_school">
        <label>School: </label>
        <select id="school" class="updates_table" name="school">
          <option></option>
          <option value="abjuration">Abjuration</option>
          <option value="conjuration">Conjuration</option>
          <option value="divination">Divination</option>
          <option value="enchantment">Enchantment</option>
          <option value="evocation">Evocation</option>
          <option value="illusion">Illusion</option>
          <option value="necromancy">Necromancy</option>
          <option value="transmutation">Transmutation</option>
        </select>
      </div>

      <div class="query_selector" id="query_selectors_ritual">
        <label>Ritual: </label>
        <select id="ritual" class="updates_table" name="ritual">
          <option></option>
          <option value="1">True</option>
          <option value="0">False</option>
        </select>
      </div>

      <div class="query_selector" id="query_selectors_castingTime">
        <label>Casting time: </label>
        <select id="query_castingTime" class="updates_table" name="query_castingTime">
          <option></option>
          <option value="action">Actions</option>
          <option value="minute">Minutes</option>
          <option value="hour">Hours</option>
          <option value="day">Days</option>
          <option>Until dispelled</option>
        </select>
      </div>

      <div class="query_selector" id="query_selectors_components">
        <label>Component types: </label>
        <select id="query_components" class="updates_table" name="query_components">
          <option></option>
          <option value="V">Verbal</option>
          <option value="S">Somatic</option>
          <option value="M">Material</option>
        </select>
      </div>

      <div class="query_selector" id="query_selectors_duration">
        <label>Duration: </label>
        <select id="query_duration" class="updates_table" name="query_duration">
          <option></option>
          <option>Instantaneous</option>
          <option value="round">Rounds</option>
          <option value="minute">Minutes</option>
          <option value="hour">Hours</option>
          <option value="day">Days</option>
          <option value="triggered">Until triggered</option>
          <option value="dispelled">Until dispelled</option>
          <option>Special</option>
        </select>
      </div>
      
      <div class="query_selector" id="query_selectors_concentration">
        <label>Concetration: </label>
        <select id="query_concentration" class="updates_table" name="query_concentration">
          <option></option>
          <option value="1">True</option>
          <option value="0">False</option>
        </select>
      </div>
    </section>

    <section id="results">
      <table id="results_table">
        <thead>
          <th>Name</th>
          <th>Classes</th>
          <th>Level</th>
          <th>School</th>
          <th>Ritual</th>
          <th>Casting Time</th>
          <th>Components</th>
          <th>Duration</th>
        </thead>
        <tbody>
        </tbody>
      </table>
    </section>

    <footer>

      <p>
        Source: <a href="http://dnd.wizards.com/articles/features/systems-reference-document-srd">The original publisher's website</a>, used here in accordance with the <a href="/mdsrd5/paged/Legal_Information.htm">Open Gaming License (OGL)</a>.
      </p>
      <p>
      Also available in <a href="https://gguillotte.github.io/mdsrd5/">single-page HTML</a>, <a href="https://gguillotte.github.io/mdsrd5/paged/">paginated HTML</a>, <a href="https://github.com/gguillotte/mdsrd5/raw/master/mdsrd5.pdf">bookmarked PDF</a>, <a href="https://github.com/gguillotte/mdsrd5/raw/master/mdsrd5.docx">DOCX</a>, <a href="https://github.com/gguillotte/mdsrd5/raw/master/mdsrd5.icml">InCopy Markup Language</a>, <a href="https://github.com/gguillotte/mdsrd5/raw/master/mdsrd5.epub">ePub 2</a>, and <a href="https://github.com/gguillotte/mdsrd5/raw/master/mdsrd5.md">Markdown</a> formats. <a href="https://github.com/gguillotte/mdsrd5">Grab a fork on GitHub</a>.
      </p>

    </footer>

  </body>
 
</html>
